<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financial Command Center</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Google Fonts -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }

    /* Animation Keyframes */
    @keyframes fade-in-up {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slide-in-right {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes spin-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .animate-fade-in-up { animation: fade-in-up 0.5s ease-out; }
    .animate-slide-in-right { animation: slide-in-right 0.5s ease-out; }
    .animate-spin-slow { animation: spin-slow 8s linear infinite; }

    /* Custom Message Box */
    #message-box {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #ef4444;
      color: white;
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 2000;
      display: none;
      text-align: center;
    }

    /* Animation Modal Overlay Wrapper */
    #onboarding-modal {
      position: fixed;
      inset: 0;
      background-color: rgba(0,0,0,0.7);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
  </style>
</head>
<body>

  <!-- React Root -->
  <div id="root"></div>

  <!-- Onboarding Animation Container -->
  <div id="onboarding-modal">
    <div id="animation-container" class="bg-[#1a2233] rounded-2xl shadow-2xl p-8 w-full max-w-lg transition-all duration-700 ease-in-out relative overflow-hidden border border-gray-700">
      <!-- Close X for quick exit -->
      <button id="quick-exit" class="absolute top-4 right-4 text-gray-400 hover:text-white" aria-label="Close tutorial">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <!-- Animated Content -->
      <div id="animation-content" class="text-center transition-opacity duration-500">
        <h2 id="animation-title" class="text-2xl sm:text-3xl font-bold text-[#ff9900] mb-4"></h2>
        <p id="animation-text" class="text-gray-300 mb-8 h-20 overflow-y-auto sm:h-auto"></p>
        <div id="animation-visual" class="relative w-full aspect-video bg-[#2c3d52] rounded-xl overflow-hidden transition-all duration-700 ease-in-out shadow-inner border border-gray-700">
          <!-- Visuals injected here -->
        </div>
        <div id="button-container" class="mt-8 flex justify-center space-x-4">
          <button id="next-button" class="px-6 py-3 bg-[#ff9900] text-[#1a2233] font-bold rounded-lg shadow-lg hover:bg-[#e68a00] transition-transform transform hover:scale-105">
            Next
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="message-box"></div>

  <!-- Onboarding Script -->
  <script>
    const titleEl = document.getElementById('animation-title');
    const textEl = document.getElementById('animation-text');
    const visualEl = document.getElementById('animation-visual');
    const nextButton = document.getElementById('next-button');
    const buttonContainer = document.getElementById('button-container');
    const modal = document.getElementById('onboarding-modal');
    const quickExit = document.getElementById('quick-exit');

    const steps = [
      {
        title: "Your Financial Command Center",
        text: "The new Business-Personal Expense-Revenue Tracker is here to help you manage your finances with ease.",
        visualHtml: `
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="w-4/5 h-4/5">
              <svg width="100%" height="100%" viewBox="0 0 540 360" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="30" y="30" width="480" height="300" rx="20" fill="#ff9900" stroke="#ffcc66" stroke-width="5"/>
                <path d="M70 70H470V280H70V70Z" fill="#2c3d52" stroke="#ffcc66" stroke-width="5"/>
                <rect x="40" y="270" width="460" height="60" rx="10" fill="#2c3d52"/>
                <circle cx="100" cy="280" r="10" fill="#ff9900"/>
                <rect x="120" y="275" width="300" height="10" rx="5" fill="#ff9900"/>
                <circle cx="440" cy="280" r="10" fill="#ff9900"/>
                <rect x="460" y="275" width="20" height="10" rx="5" fill="#ff9900"/>
              </svg>
            </div>
          </div>
        `,
      },
      {
        title: "1. Add a New Transaction",
        text: "Fill out the simple form with details like date, description, type, and amount. Our smart categories make it easy.",
        visualHtml: `
          <div class="absolute inset-4 p-4 bg-[#2c3d52] rounded-lg flex flex-col space-y-2 animate-fade-in-up">
            <input disabled type="date" class="p-2 border border-[#ff9900] rounded-md bg-[#1a2233] text-gray-500 opacity-70">
            <input disabled type="text" placeholder="Flight Instruction" class="p-2 border border-[#ff9900] rounded-md bg-[#1a2233] text-gray-300">
            <div class="flex space-x-2">
              <div class="p-2 border border-[#ff9900] rounded-md flex-1 bg-[#1a2233] text-gray-300 text-center text-sm">Revenue</div>
              <div class="p-2 border border-[#ff9900] rounded-md flex-1 bg-[#1a2233] text-gray-300 text-center text-sm">Business</div>
            </div>
          </div>
        `,
      },
      {
        title: "2. View Your Financial Summary",
        text: "The dashboard provides real-time totals for your business and personal accounts, helping you stay on top of your finances.",
        visualHtml: `
          <div class="absolute inset-4 grid grid-cols-2 gap-4 place-content-center">
            <div class="bg-[#1a2233] p-2 rounded-lg border border-[#ffcc66] animate-fade-in-up">
              <p class="text-[10px] text-gray-400">Biz Rev</p>
              <p class="text-lg font-bold text-[#ff9900]">$7,250</p>
            </div>
            <div class="bg-[#1a2233] p-2 rounded-lg border border-[#ffcc66] animate-fade-in-up" style="animation-delay: 0.1s">
              <p class="text-[10px] text-gray-400">Biz Exp</p>
              <p class="text-lg font-bold text-red-400">$1,662</p>
            </div>
            <div class="bg-[#1a2233] p-2 rounded-lg border border-[#ffcc66] animate-fade-in-up" style="animation-delay: 0.2s">
              <p class="text-[10px] text-gray-400">Pers Exp</p>
              <p class="text-lg font-bold text-yellow-500">$2,985</p>
            </div>
          </div>
        `,
      },
      {
        title: "3. Export Data for Tax Season",
        text: "Easily export your data to a CSV file with a single click. This makes it simple to share with your accountant.",
        visualHtml: `
          <div class="absolute inset-4 flex flex-col items-center justify-center space-y-4">
            <div class="text-6xl animate-bounce">üìÅ</div>
            <p class="text-sm font-semibold text-gray-300">transactions.csv</p>
          </div>
        `,
      },
      {
        title: "Start Tracking Today!",
        text: "Take control of your finances and simplify your life. Get started with our new Business Tracker tool now.",
        visualHtml: `
          <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
            <div class="relative w-20 h-20 mb-4 animate-spin-slow">
              <div class="absolute inset-0 border-4 border-[#ff9900] rounded-full border-t-transparent"></div>
              <div class="absolute inset-4 border-4 border-[#ffcc66] rounded-full border-t-transparent"></div>
              <div class="absolute inset-6 flex items-center justify-center text-3xl text-[#ff9900]">‚úàÔ∏è</div>
            </div>
          </div>
        `,
      }
    ];

    let currentStep = 0;

    function updateContent() {
      const step = steps[currentStep];
      titleEl.textContent = step.title;
      textEl.textContent = step.text;
      visualEl.innerHTML = step.visualHtml;

      if (currentStep < steps.length - 1) {
        nextButton.style.display = 'block';
        nextButton.textContent = 'Next';
        const existingReplay = document.getElementById('replay-button');
        const existingExit = document.getElementById('exit-button');
        if (existingReplay) existingReplay.remove();
        if (existingExit) existingExit.remove();
      } else {
        nextButton.style.display = 'none';
        showFinalButtons();
      }
    }

    function showFinalButtons() {
      buttonContainer.innerHTML = '';

      const replayBtn = document.createElement('button');
      replayBtn.id = 'replay-button';
      replayBtn.className = "px-6 py-3 bg-[#ff9900] text-[#1a2233] font-semibold rounded-lg shadow-md hover:bg-[#e68a00] transition-colors";
      replayBtn.textContent = "Replay";
      replayBtn.onclick = () => {
        currentStep = 0;
        buttonContainer.innerHTML = '';
        buttonContainer.appendChild(nextButton);
        updateContent();
      };

      const exitBtn = document.createElement('button');
      exitBtn.id = 'exit-button';
      exitBtn.className = "px-6 py-3 bg-gray-500 text-white font-semibold rounded-lg shadow-md hover:bg-gray-600 transition-colors ml-4";
      exitBtn.textContent = "Exit to App";
      exitBtn.onclick = closeAnimation;

      buttonContainer.appendChild(replayBtn);
      buttonContainer.appendChild(exitBtn);
    }

    function closeAnimation() {
      modal.style.opacity = '0';
      setTimeout(() => {
        modal.style.display = 'none';
      }, 500);
    }

    nextButton.addEventListener('click', () => {
      currentStep++;
      updateContent();
    });

    quickExit.addEventListener('click', closeAnimation);

    updateContent();
  </script>

  <!-- React Application Script -->
  <script type="text/babel">
    const { useState, useEffect } = React;

    const initialData = [
      { id: 1, name: 'Example 1', date: '2025-08-18', description: 'Monthly Paycheck', type: 'Revenue', category: 'Salary / Wages', allocation: 'Business', amount: 7250.00, notes: 'Direct deposit' },
      { id: 2, name: 'Example 2', date: '2025-08-19', description: 'Bose A30 Headset', type: 'Expense', category: 'Equipment', allocation: 'Business', amount: 1295.00, notes: 'Required tool' },
      { id: 3, name: 'Example 3', date: '2025-08-20', description: 'Uber to Hotel', type: 'Expense', category: 'Ground Transport', allocation: 'Business', amount: 45.50, notes: 'Layover' },
      { id: 4, name: 'Example 4', date: '2025-08-21', description: 'Groceries', type: 'Expense', category: 'Groceries', allocation: 'Personal', amount: 185.40, notes: '' },
    ];

    const App = () => {
      const [transactions, setTransactions] = useState(initialData);
      const [formData, setFormData] = useState({
        date: '',
        description: '',
        type: 'Expense',
        category: '',
        allocation: 'Business',
        amount: '',
        notes: '',
      });
      const [filters, setFilters] = useState({ type: '', allocation: '', searchTerm: '' });
      const [sort, setSort] = useState({ key: 'date', direction: 'desc' });
      const [summary, setSummary] = useState({
        businessRevenue: 0,
        personalRevenue: 0,
        businessExpense: 0,
        personalExpense: 0,
      });

      const categories = {
        Expense: {
          Business: [
            'Meals (on layovers)', 'Ground Transport', 'Hotel / Lodging', 'Parking', 'Tips',
            'Equipment', 'Uniforms', 'Charts & Manuals', 'Software & Apps',
            'Dues & Subscriptions', 'Medical Certificate', 'Training', 'Licensing & Fees', 'Insurance',
            'Fuel', 'Maintenance', 'Hangar / Tiedown'
          ],
          Personal: [
            'Mortgage / Rent', 'Groceries', 'Dining Out', 'Utilities', 'Transportation', 'Health Insurance',
            'Entertainment', 'Savings', 'Debt Payment'
          ],
        },
        Revenue: {
          Business: [
            'Salary / Wages', 'Per Diem', 'Overtime Pay', 'Bonus', 'Flight Instruction', 'Contract Flying'
          ],
          Personal: [
            'Investment Income', 'Rental Income', 'Spouse Income', 'Other / Gift'
          ],
        },
      };

      useEffect(() => {
        const newSummary = transactions.reduce((acc, current) => {
          const amount = parseFloat(current.amount) || 0;
          if (current.type === 'Revenue') {
            if (current.allocation === 'Business') acc.businessRevenue += amount;
            else acc.personalRevenue += amount;
          } else if (current.type === 'Expense') {
            if (current.allocation === 'Business') acc.businessExpense += amount;
            else acc.personalExpense += amount;
          }
          return acc;
        }, { businessRevenue: 0, personalRevenue: 0, businessExpense: 0, personalExpense: 0 });
        setSummary(newSummary);
      }, [transactions]);

      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => {
          const isBusinessCategory = categories.Expense.Business.includes(value);
          const isBusinessRevenue = categories.Revenue.Business.includes(value);
          if (name === 'category' && (isBusinessCategory || isBusinessRevenue)) {
            return { ...prev, [name]: value, allocation: 'Business' };
          }
          const isPersonalCategory = categories.Expense.Personal.includes(value);
          const isPersonalRevenue = categories.Revenue.Personal.includes(value);
          if (name === 'category' && (isPersonalCategory || isPersonalRevenue)) {
            return { ...prev, [name]: value, allocation: 'Personal' };
          }
          return { ...prev, [name]: value };
        });
      };

      const handleAddTransaction = () => {
        if (!formData.date || !formData.description || !formData.amount) {
          const msgBox = document.getElementById('message-box');
          msgBox.innerHTML = 'Please fill out Date, Description, and Amount.';
          msgBox.style.display = 'block';
          setTimeout(() => { msgBox.style.display = 'none'; }, 3000);
          return;
        }

        const newTransaction = {
          ...formData,
          id: Date.now(),
          name: `Entry ${transactions.length + 1}`,
          amount: parseFloat(formData.amount),
        };

        setTransactions(prev => [...prev, newTransaction]);
        setFormData({
          date: '', description: '', type: 'Expense', category: '', allocation: 'Business', amount: '', notes: ''
        });
      };

      const handleDeleteTransaction = (id) => {
        setTransactions(prev => prev.filter(t => t.id !== id));
      };

      const handleFilterChange = (e) => {
        const { name, value } = e.target;
        setFilters(prev => ({ ...prev, [name]: value }));
      };

      const getFilteredAndSortedTransactions = () => {
        let filtered = transactions;
        if (filters.type) filtered = filtered.filter(t => t.type === filters.type);
        if (filters.allocation) filtered = filtered.filter(t => t.allocation === filters.allocation);
        if (filters.searchTerm) {
          const term = filters.searchTerm.toLowerCase();
          filtered = filtered.filter(t =>
            (t.description || '').toLowerCase().includes(term) ||
            (t.notes || '').toLowerCase().includes(term)
          );
        }

        return filtered.sort((a, b) => {
          const aValue = a[sort.key];
          const bValue = b[sort.key];
          if (aValue < bValue) return sort.direction === 'asc' ? -1 : 1;
          if (aValue > bValue) return sort.direction === 'asc' ? 1 : -1;
          return 0;
        });
      };

      const handleExport = () => {
        const data = getFilteredAndSortedTransactions();
        const headers = ['Date', 'Description', 'Type', 'Allocation', 'Category', 'Amount', 'Notes'];
        const csvContent = "data:text/csv;charset=utf-8," +
          headers.join(',') + "\n" +
          data.map(t => [
            t.date,
            `"${String(t.description || '').replace(/"/g, '""')}"`,
            t.type,
            t.allocation,
            t.category,
            t.amount,
            `"${String(t.notes || '').replace(/"/g, '""')}"`
          ].join(',')).join('\n');

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "transactions.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      const currentCategories = categories[formData.type]?.[formData.allocation] || [];
      const displayedTransactions = getFilteredAndSortedTransactions();

      return (
        <div className="min-h-screen p-4 sm:p-8 text-gray-800">
          <div className="max-w-7xl mx-auto">
            <header className="mb-8 flex flex-col items-center">
              <h1 className="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-center mb-2 text-indigo-700">Financial Command Center</h1>
              <p className="text-center text-gray-600 max-w-2xl">Track expenses and revenue with automatic allocation.</p>
              <button onClick={() => {
                const m = document.getElementById('onboarding-modal');
                m.style.display = 'flex';
                m.style.opacity = '1';
              }} className="mt-4 text-sm text-indigo-600 hover:text-indigo-800 underline">
                Replay Tutorial
              </button>
            </header>

            <section className="bg-white p-6 rounded-2xl shadow-lg mb-8">
              <h2 className="text-2xl font-bold mb-4 text-indigo-600">Summary</h2>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                <div className="bg-blue-50 p-4 rounded-xl shadow-inner border border-blue-200">
                  <p className="text-sm font-medium text-gray-500">Business Revenue</p>
                  <p className="text-2xl font-bold text-blue-700 mt-1">${summary.businessRevenue.toFixed(2)}</p>
                </div>
                <div className="bg-green-50 p-4 rounded-xl shadow-inner border border-green-200">
                  <p className="text-sm font-medium text-gray-500">Personal Revenue</p>
                  <p className="text-2xl font-bold text-green-700 mt-1">${summary.personalRevenue.toFixed(2)}</p>
                </div>
                <div className="bg-red-50 p-4 rounded-xl shadow-inner border border-red-200">
                  <p className="text-sm font-medium text-gray-500">Business Expense</p>
                  <p className="text-2xl font-bold text-red-700 mt-1">${summary.businessExpense.toFixed(2)}</p>
                </div>
                <div className="bg-yellow-50 p-4 rounded-xl shadow-inner border border-yellow-200">
                  <p className="text-sm font-medium text-gray-500">Personal Expense</p>
                  <p className="text-2xl font-bold text-yellow-700 mt-1">${summary.personalExpense.toFixed(2)}</p>
                </div>
              </div>
            </section>

            <section className="bg-white p-6 rounded-2xl shadow-lg mb-8">
              <h2 className="text-2xl font-bold mb-4 text-indigo-600">Add Transaction</h2>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <input type="date" name="date" value={formData.date} onChange={handleInputChange} className="p-3 border rounded-lg w-full" />
                <input type="text" name="description" placeholder="Description" value={formData.description} onChange={handleInputChange} className="p-3 border rounded-lg w-full" />
                <select name="type" value={formData.type} onChange={handleInputChange} className="p-3 border rounded-lg w-full">
                  <option value="Expense">Expense</option>
                  <option value="Revenue">Revenue</option>
                </select>
                <select name="allocation" value={formData.allocation} onChange={handleInputChange} className="p-3 border rounded-lg w-full">
                  <option value="Business">Business</option>
                  <option value="Personal">Personal</option>
                </select>
                <select name="category" value={formData.category} onChange={handleInputChange} className="p-3 border rounded-lg w-full">
                  <option value="">Select Category</option>
                  {currentCategories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                </select>
                <input type="number" name="amount" placeholder="Amount" value={formData.amount} onChange={handleInputChange} className="p-3 border rounded-lg w-full" />
                <input type="text" name="notes" placeholder="Notes (Optional)" value={formData.notes} onChange={handleInputChange} className="p-3 border rounded-lg w-full sm:col-span-2 lg:col-span-1" />
                <button onClick={handleAddTransaction} className="w-full p-3 font-semibold text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg shadow-md lg:col-span-1">Add</button>
              </div>
            </section>

            <section className="bg-white p-6 rounded-2xl shadow-lg">
              <div className="flex flex-wrap items-center justify-between mb-4 gap-4">
                <h2 className="text-2xl font-bold text-indigo-600">Log</h2>
                <div className="flex gap-2">
                  <input type="text" name="searchTerm" placeholder="Search..." value={filters.searchTerm} onChange={handleFilterChange} className="p-2 border rounded-lg text-sm" />
                  <button onClick={handleExport} className="p-2 bg-green-600 text-white rounded-lg text-sm">Export CSV</button>
                </div>
              </div>

              <div className="sm:hidden space-y-4">
                {displayedTransactions.map(t => (
                  <div key={t.id} className="bg-gray-50 p-4 rounded-xl border relative">
                    <button onClick={() => handleDeleteTransaction(t.id)} className="absolute top-2 right-2 text-red-500" aria-label="Delete">‚úï</button>
                    <p className="font-bold">{t.description}</p>
                    <div className="flex justify-between text-sm mt-2">
                      <span>{t.date}</span>
                      <span className={t.type === 'Revenue' ? 'text-green-600 font-bold' : 'text-red-600 font-bold'}>${Number(t.amount).toFixed(2)}</span>
                    </div>
                    <div className="text-xs text-gray-500 mt-1">{t.allocation} - {t.category}</div>
                  </div>
                ))}
              </div>

              <div className="hidden sm:block overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Allocation</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                      <th className="px-4 py-2"></th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {displayedTransactions.map(t => (
                      <tr key={t.id}>
                        <td className="px-4 py-2 whitespace-nowrap text-sm">{t.date}</td>
                        <td className="px-4 py-2 whitespace-nowrap text-sm">{t.description}</td>
                        <td className="px-4 py-2 whitespace-nowrap text-sm">{t.type}</td>
                        <td className="px-4 py-2 whitespace-nowrap text-sm">{t.allocation}</td>
                        <td className="px-4 py-2 whitespace-nowrap text-sm">{t.category}</td>
                        <td className="px-4 py-2 whitespace-nowrap text-sm font-bold">${Number(t.amount).toFixed(2)}</td>
                        <td className="px-4 py-2 text-right">
                          <button onClick={() => handleDeleteTransaction(t.id)} className="text-red-600 hover:text-red-900 text-sm">Delete</button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </section>

            <footer className="mt-8 text-center text-gray-500 text-xs">
              <p>&copy; 2025 About-Face Tax Group LLC</p>
            </footer>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
